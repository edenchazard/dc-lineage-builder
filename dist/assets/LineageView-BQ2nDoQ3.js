import{d as P,r as L,i as k,o as l,c as p,O as B,x as R,Q as se,ao as K,ap as H,q as ie,a6 as N,_ as x,f as b,j as W,ac as le,aq as J,ar as F,D as de,a5 as I,aa as $,as as ce,at as re,S as M,a as D,b as f,A as y,P as ue,H as O,L as C,w as fe}from"./index-CkVLQWri.js";import{D as be}from"./DragonPortrait-D5BSQTBz.js";import{L as me}from"./LineageWrapper-D2uaZU0p.js";const ve=["placeholder","value"],ge=["tabindex"],he=P({__name:"LineageViewNodeLabel",props:{value:{type:String,required:!0},display:{type:Number,required:!0},disabled:{type:Boolean,default:!0}},emits:["changed"],setup(e,{emit:t}){const n=e,d=t,o=L(!1),c=L(),w=k(()=>[n.display===1?"code":"name"]);function v(){const i=c.value;if(!(i instanceof HTMLTextAreaElement))return;const A=!(n.display===1?K:H)(i.value);i.style.height="auto",i.style.height=i.scrollHeight+"px",i.classList[A?"add":"remove"]("bad")}async function g(){var i,r;n.disabled||(o.value=!0,await ie(),(r=(i=c.value)==null?void 0:i.focus)==null||r.call(i))}function s(i){let r=i.target.value;r===""&&(r=n.display===1?N.generateCode():N.generateName()),d("changed",r),o.value=!1}return(i,r)=>o.value?(l(),p("textarea",{key:0,ref_key:"inputEl",ref:c,class:B(["label-block input",w.value]),placeholder:`Enter new ${e.display===1?"code":"name"}`,value:e.value,spellcheck:"false",rows:"1",onFocus:v,onInput:v,onKeydown:R(s,["enter"]),onBlur:s},null,42,ve)):(l(),p("div",{key:1,class:B(["label-block label",w.value]),role:"button",tabindex:e.disabled?-1:0,onKeyup:R(g,["space","enter"]),onClick:g},se(e.display===1?`(${e.value})`:e.value),43,ge))}}),ye=x(he,[["__scopeId","data-v-1b1db947"]]),pe=["title"],we=P({__name:"LineageViewNodeButton",props:{title:{type:String,required:!0},icon:{type:String,required:!0}},emits:["click"],setup(e,{emit:t}){const n=t;return(d,o)=>(l(),p("button",{class:"tile-button pointer",type:"button",title:e.title,onClick:o[0]||(o[0]=c=>n("click"))},[b(W(le),{icon:e.icon,class:"graphic"},null,8,["icon"])],8,pe))}}),u=x(we,[["__scopeId","data-v-6fbcd3fd"]]),G="long-press-no-select";let q,S=!1;function ke(e){e.preventDefault()}function j(e){return e.pointerType==="mouse"&&e.button===2}function Le(){clearTimeout(q),S=!1}const Ce={beforeMount(e,t){const{onLongPress:n,onClick:d,onPress:o,wait:c=500,disableRightClickMenu:w}=t.value;function v(s){S=!1,!(s instanceof PointerEvent&&j(s))&&(q=window.setTimeout(()=>{S=!0,n&&n(s)},c),o&&o(s))}function g(s){s instanceof PointerEvent&&j(s)||(clearTimeout(q),!S&&d&&setTimeout(()=>d(s),20))}e.addEventListener("pointerdown",v),e.addEventListener("pointerup",g),e.addEventListener("pointerout",Le),e.addEventListener("keyup",s=>{s.code==="Space"&&g(s)}),w&&e.addEventListener("contextmenu",ke),e.classList.add(G)},updated(e){e.classList.add(G)}},z=J(document.documentElement,!1),Q=J(document.body,!1),m=L(),T=L(!1),U=L();let E;function Se(e){const t={autofocus:!1,breedSelectedCallback:null,...e};T.value=t.autofocus,U.value=t.forGender,E=t.breedSelectedCallback,z.value=Q.value=!0,m.value&&(m.value.showModal(),m.value.dataset.openTime=Date.now().toString())}function Be(){var n,d,o;const e=(n=m.value)==null?void 0:n.querySelector(".results");e&&(e.scrollTop=0);const t=(d=m.value)==null?void 0:d.querySelectorAll("[data-roving-tabindex]");t==null||t.forEach(c=>{c.setAttribute("tabindex","-1")}),(o=t==null?void 0:t[0])==null||o.setAttribute("tabindex","0"),T.value=!1,m.value&&(m.value.close(),m.value.dataset.openTime=""),E=null,z.value=Q.value=!1}function Ne(e){E&&E(e)}function Ee(){return{dialogRef:m,autofocus:F(T),forGender:F(U),show:Se,hide:Be,handleBreedSelected:Ne}}const Pe={class:"tile-container"},xe={class:"tile"},Ae=["disabled"],De={class:"tile-button-right"},qe={class:"tile-bottom-controls tile-button-group"},Te={key:0,class:"tile-parents"},Ve=P({__name:"LineageViewNode",props:{data:{type:Object,required:!0},disabled:{type:Boolean,default:!0,required:!1},nodesFromRoot:{type:Number,required:!0}},setup(e){const t=e,n=localStorage,d=de(),o=Ee(),c=k(()=>I(t.data)),w=k(()=>{const a=$(t.data.breed);return ce(a,re(t.data.gender))}),v=k(()=>{const a=[];return H(t.data.name)||a.push("Name is invalid."),K(t.data.code)||a.push("Code is invalid."),a.join("")});function g(){const a=t.data.gender==="f"?"m":"f";if(t.data.breed==="Placeholder")t.data.gender=a,t.data.breed=O.name;else{const h=$(t.data.breed);if(!h)return;h.genderOnly?(t.data.gender=a,t.data.breed=O.name):t.data.gender=a}}function s(a){o.hide(),t.data.breed=a.name}function i(){const a=n.getItem("clipboard");a!==null&&(t.data.parents=JSON.parse(a))}function r(){Object.assign(t.data,C(t.data).switchParents().raw())}function A(){!c.value||!I(t.data)||n.setItem("clipboard",JSON.stringify({m:C(t.data.parents.m).withoutMetadata().raw(),f:C(t.data.parents.f).withoutMetadata().raw()}))}function X(){d.activeTree=t.data}function Y(){d.addDescendant()}function Z(){t.data.parents={m:N.createWithMetadata({gender:"m"}),f:N.createWithMetadata({gender:"f"})}}function _(){t.data.parents={}}function ee(a){const h=t.data.display===1?"code":"name";t.data[h]=a}function te(){t.data.display=t.data.display===1?0:1}function ae(){t.disabled||(d.selectionCount===0?t.data.selected||(t.data.selected=!0):t.data.selected=!t.data.selected)}function ne(a){t.disabled||(d.selectionCount>0?t.data.selected=!t.data.selected:o.show({autofocus:a instanceof KeyboardEvent&&a.code==="Space",forGender:t.data.gender,breedSelectedCallback:h=>s(h)}))}return(a,h)=>{const oe=M("FontAwesomeIcon"),V=M("LineageViewNode",!0);return l(),p("li",Pe,[D("div",xe,[e.nodesFromRoot===0?(l(),f(u,{key:0,class:"tile-button-left tile-button-add-desc",title:"Add descendant",icon:"arrow-left",onClick:Y})):y("",!0),e.nodesFromRoot>0?(l(),f(u,{key:1,class:"tile-button-left tile-button-remove-desc",title:"Remove descendants",icon:"cut",onClick:X})):y("",!0),ue((l(),p("button",{class:"dragon-breed-picker-button pointer",disabled:e.disabled,type:"button"},[b(be,{data:w.value,class:B({selected:e.data.selected})},null,8,["data","class"])],8,Ae)),[[W(Ce),{wait:300,onClick:ne,onLongPress:ae}]]),b(oe,{icon:"warning",class:B([{visible:v.value.length>0},"label-warning"]),title:v.value,"aria-label":v.value},null,8,["class","title","aria-label"]),D("div",De,[c.value?(l(),f(u,{key:0,class:"switch",title:"Switch parents",icon:"sync-alt",onClick:r})):y("",!0),c.value?(l(),f(u,{key:1,title:"Remove ancestors",icon:"minus",onClick:_})):(l(),f(u,{key:2,class:"tile-button-right",title:"Add ancestors",icon:"arrow-right",onClick:Z}))]),b(ye,{value:e.data.display===1?e.data.code:e.data.name,display:e.data.display,disabled:e.disabled,onChanged:ee},null,8,["value","display","disabled"]),D("div",qe,[e.nodesFromRoot===0&&e.data.gender==="m"?(l(),f(u,{key:0,title:"Switch gender to female",icon:"mars",onClick:g})):e.nodesFromRoot===0&&e.data.gender==="f"?(l(),f(u,{key:1,title:"Switch gender to male",icon:"venus",onClick:g})):y("",!0),b(u,{class:"switchLabel",title:"Switch label",icon:"font",onClick:te}),c.value?(l(),f(u,{key:2,title:"Copy ancestors",icon:"clone",onClick:A})):y("",!0),b(u,{title:"Paste ancestors",icon:"paste",onClick:i})])]),c.value?(l(),p("ul",Te,[b(V,{data:e.data.parents.m,"nodes-from-root":e.nodesFromRoot+1,disabled:e.disabled},null,8,["data","nodes-from-root","disabled"]),b(V,{data:e.data.parents.f,"nodes-from-root":e.nodesFromRoot+1,disabled:e.disabled},null,8,["data","nodes-from-root","disabled"])])):y("",!0)])}}}),Re=x(Ve,[["__scopeId","data-v-d6775774"]]),Fe={key:0,class:"lineage-root"},Ie=P({__name:"LineageView",props:{root:{type:Object,required:!0,default:null},config:{type:Object,required:!1,default:()=>({showLabels:!0,showInterface:!1,disabled:!0})}},setup(e){const t=e,n=k(()=>t.root?C(t.root).generations():0);return(d,o)=>(l(),f(me,{generations:n.value,"data-show-labels":e.config.showLabels,"data-show-editor-interface":e.config.showInterface},{default:fe(()=>[e.root!==null?(l(),p("ul",Fe,[b(Re,{data:e.root,"nodes-from-root":0,disabled:e.config.disabled},null,8,["data","disabled"])])):y("",!0)]),_:1},8,["generations","data-show-labels","data-show-editor-interface"]))}}),Ge=x(Ie,[["__scopeId","data-v-8caa965a"]]);export{Ge as L,Ee as u};
