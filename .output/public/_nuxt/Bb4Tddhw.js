import{d as E,r as L,k,x as p,y as s,Z as O,ad as N,A as se,az as G,aP as _,a2 as ie,ar as x,_ as P,B as f,O as K,as as le,aQ as R,aR as z,a4 as de,z as A,Y as y,K as u,ae as ce,g as re,aq as q,aC as F,aS as ue,aT as fe,a7 as $,N as C,C as be}from"#entry";import{D as me}from"./5u4QIE9S.js";import{L as ge}from"./DhFJ7mD2.js";const ve=["placeholder","value"],he=["tabindex"],ye=E({__name:"LineageViewNodeLabel",props:{value:{type:String,required:!0},display:{type:Number,required:!0},disabled:{type:Boolean,default:!0}},emits:["changed"],setup(e,{emit:t}){const n=e,d=t,i=L(!1),l=L(),w=k(()=>[n.display===1?"code":"name"]);function m(){const c=l.value;if(!(c instanceof HTMLTextAreaElement))return;const V=!(n.display===1?G:_)(c.value);c.style.height="auto",c.style.height=c.scrollHeight+"px",c.classList[V?"add":"remove"]("bad")}async function g(){n.disabled||(i.value=!0,await ie(),l.value?.focus?.())}function o(c){let h=c.target.value;h===""&&(h=n.display===1?x.generateCode():x.generateName()),d("changed",h),i.value=!1}return(c,h)=>i.value?(s(),p("textarea",{key:0,ref_key:"inputEl",ref:l,class:N(["label-block input",w.value]),placeholder:`Enter new ${e.display===1?"code":"name"}`,value:e.value,spellcheck:"false",rows:"1",onFocus:m,onInput:m,onKeydown:O(o,["enter"]),onBlur:o},null,42,ve)):(s(),p("div",{key:1,class:N(["label-block label",w.value]),role:"button",tabindex:e.disabled?-1:0,onKeyup:O(g,["space","enter"]),onClick:g},se(e.display===1?`(${e.value})`:e.value),43,he))}}),pe=Object.assign(P(ye,[["__scopeId","data-v-95da1f63"]]),{__name:"LineageViewNodeLabel"}),we=["title"],ke=E({__name:"LineageViewNodeButton",props:{title:{type:String,required:!0},icon:{type:String,required:!0}},emits:["click"],setup(e,{emit:t}){const n=t;return(d,i)=>(s(),p("button",{class:"tile-button pointer",type:"button",title:e.title,onClick:i[0]||(i[0]=l=>n("click"))},[f(K(le),{icon:e.icon,class:"graphic"},null,8,["icon"])],8,we))}}),r=Object.assign(P(ke,[["__scopeId","data-v-6fbcd3fd"]]),{__name:"LineageViewNodeButton"}),j="long-press-no-select";let D,S=!1;function Le(e){e.preventDefault()}function M(e){return e.pointerType==="mouse"&&e.button===2}function Ce(){clearTimeout(D),S=!1}const Se={beforeMount(e,t){const{onLongPress:n,onClick:d,onPress:i,wait:l=500,disableRightClickMenu:w}=t.value;function m(o){S=!1,!(o instanceof PointerEvent&&M(o))&&(D=window.setTimeout(()=>{S=!0,n&&n(o)},l),i&&i(o))}function g(o){o instanceof PointerEvent&&M(o)||(clearTimeout(D),!S&&d&&setTimeout(()=>d(o),20))}e.addEventListener("pointerdown",m),e.addEventListener("pointerup",g),e.addEventListener("pointerout",Ce),e.addEventListener("keyup",o=>{o.code==="Space"&&g(o)}),w&&e.addEventListener("contextmenu",Le),e.classList.add(j)},updated(e){e.classList.add(j)}},W=z(document.documentElement,!1),H=z(document.body,!1),b=L(),I=L(!1),J=L();let B;function Ne(e){const t={autofocus:!1,breedSelectedCallback:null,...e};I.value=t.autofocus,J.value=t.forGender,B=t.breedSelectedCallback,W.value=H.value=!0,b.value&&(b.value.showModal(),b.value.dataset.openTime=Date.now().toString())}function xe(){const e=b.value?.querySelector(".results");e&&(e.scrollTop=0);const t=b.value?.querySelectorAll("[data-roving-tabindex]");t?.forEach(n=>{n.setAttribute("tabindex","-1")}),t?.[0]?.setAttribute("tabindex","0"),I.value=!1,b.value&&(b.value.close(),b.value.dataset.openTime=""),B=null,W.value=H.value=!1}function Be(e){B&&B(e)}function Ee(){return{dialogRef:b,autofocus:R(I),forGender:R(J),show:Ne,hide:xe,handleBreedSelected:Be}}const Pe={class:"tile-container"},Ve={class:"tile"},Ae=["disabled"],De={class:"tile-button-right"},Ie={class:"tile-bottom-controls tile-button-group"},Te={key:0,class:"tile-parents"},Oe=E({__name:"LineageViewNode",props:{data:{type:Object,required:!0},disabled:{type:Boolean,default:!0,required:!1},nodesFromRoot:{type:Number,required:!0}},setup(e){const t=e,n=localStorage,d=de(),i=Ee(),l=k(()=>q(t.data)),w=k(()=>{const a=F(t.data.breed);return ue(a,fe(t.data.gender))}),m=k(()=>{const a=[];return _(t.data.name)||a.push("Name is invalid."),G(t.data.code)||a.push("Code is invalid."),a.join("")});function g(){const a=t.data.gender==="f"?"m":"f";if(t.data.breed==="Placeholder")t.data.gender=a,t.data.breed=$.name;else{const v=F(t.data.breed);if(!v)return;v.genderOnly?(t.data.gender=a,t.data.breed=$.name):t.data.gender=a}}function o(a){i.hide(),t.data.breed=a.name}function c(){const a=n.getItem("clipboard");a!==null&&(t.data.parents=JSON.parse(a))}function h(){Object.assign(t.data,C(t.data).switchParents().raw())}function V(){!l.value||!q(t.data)||n.setItem("clipboard",JSON.stringify({m:C(t.data.parents.m).withoutMetadata().raw(),f:C(t.data.parents.f).withoutMetadata().raw()}))}function U(){d.activeTree=t.data}function Y(){d.addDescendant()}function Z(){t.data.parents={m:x.createWithMetadata({gender:"m"}),f:x.createWithMetadata({gender:"f"})}}function X(){t.data.parents={}}function ee(a){const v=t.data.display===1?"code":"name";t.data[v]=a}function te(){t.data.display=t.data.display===1?0:1}function ae(){t.disabled||(d.selectionCount===0?t.data.selected||(t.data.selected=!0):t.data.selected=!t.data.selected)}function ne(a){t.disabled||(d.selectionCount>0?t.data.selected=!t.data.selected:i.show({autofocus:a instanceof KeyboardEvent&&a.code==="Space",forGender:t.data.gender,breedSelectedCallback:v=>o(v)}))}return(a,v)=>{const oe=re("FontAwesomeIcon"),T=Q;return s(),p("li",Pe,[A("div",Ve,[e.nodesFromRoot===0?(s(),u(r,{key:0,class:"tile-button-left tile-button-add-desc",title:"Add descendant",icon:"arrow-left",onClick:Y})):y("",!0),e.nodesFromRoot>0?(s(),u(r,{key:1,class:"tile-button-left tile-button-remove-desc",title:"Remove descendants",icon:"cut",onClick:U})):y("",!0),ce((s(),p("button",{class:"dragon-breed-picker-button pointer",disabled:e.disabled,type:"button"},[f(me,{data:w.value,class:N({selected:e.data.selected})},null,8,["data","class"])],8,Ae)),[[K(Se),{wait:300,onClick:ne,onLongPress:ae}]]),f(oe,{icon:"warning",class:N([{visible:m.value.length>0},"label-warning"]),title:m.value,"aria-label":m.value},null,8,["class","title","aria-label"]),A("div",De,[l.value?(s(),u(r,{key:0,class:"switch",title:"Switch parents",icon:"sync-alt",onClick:h})):y("",!0),l.value?(s(),u(r,{key:1,title:"Remove ancestors",icon:"minus",onClick:X})):(s(),u(r,{key:2,class:"tile-button-right",title:"Add ancestors",icon:"arrow-right",onClick:Z}))]),f(pe,{value:e.data.display===1?e.data.code:e.data.name,display:e.data.display,disabled:e.disabled,onChanged:ee},null,8,["value","display","disabled"]),A("div",Ie,[e.nodesFromRoot===0&&e.data.gender==="m"?(s(),u(r,{key:0,title:"Switch gender to female",icon:"mars",onClick:g})):e.nodesFromRoot===0&&e.data.gender==="f"?(s(),u(r,{key:1,title:"Switch gender to male",icon:"venus",onClick:g})):y("",!0),f(r,{class:"switchLabel",title:"Switch label",icon:"font",onClick:te}),l.value?(s(),u(r,{key:2,title:"Copy ancestors",icon:"clone",onClick:V})):y("",!0),f(r,{title:"Paste ancestors",icon:"paste",onClick:c})])]),l.value?(s(),p("ul",Te,[f(T,{data:e.data.parents.m,"nodes-from-root":e.nodesFromRoot+1,disabled:e.disabled},null,8,["data","nodes-from-root","disabled"]),f(T,{data:e.data.parents.f,"nodes-from-root":e.nodesFromRoot+1,disabled:e.disabled},null,8,["data","nodes-from-root","disabled"])])):y("",!0)])}}}),Q=Object.assign(P(Oe,[["__scopeId","data-v-ca57003b"]]),{__name:"LineageViewNode"}),Re={key:0,class:"lineage-root"},qe=E({__name:"LineageView",props:{root:{type:Object,required:!0,default:null},config:{type:Object,required:!1,default:()=>({showLabels:!0,showInterface:!1,disabled:!0})}},setup(e){const t=e,n=k(()=>t.root?C(t.root).generations():0);return(d,i)=>(s(),u(ge,{generations:n.value,"data-show-labels":e.config.showLabels,"data-show-editor-interface":e.config.showInterface},{default:be(()=>[e.root!==null?(s(),p("ul",Re,[f(Q,{data:e.root,"nodes-from-root":0,disabled:e.config.disabled},null,8,["data","disabled"])])):y("",!0)]),_:1},8,["generations","data-show-labels","data-show-editor-interface"]))}}),Me=Object.assign(P(qe,[["__scopeId","data-v-8c1378ea"]]),{__name:"LineageView"});export{Me as L,Ee as u};
